#!/bin/sh

BUILD=$1
HTTP_USER=alp
MODELER=~/Projects/mendix/integration/modeler/StartUpProject/bin
RUNTIME=~/Mendix/bin

read -s -p "Password: " HTTP_PASSWD
echo ""

echo "Downloading MxBuild results for build $BUILD"

rm -f mxbuild-6-build$BUILD.tar.gz
wget --auth-no-challenge --no-check-certificate --http-user=$HTTP_USER --http-passwd=$HTTP_PASSWD "https://kate.rnd.hq.mendix.net/job/AppStudio/$BUILD/artifact/artifacts/mxbuild-6-build$BUILD.tar.gz"

echo "Extracting MxBuild results to folder $BUILD"
rm -rf $BUILD
mkdir $BUILD
tar -xzf mxbuild-6-build$BUILD.tar.gz -C $BUILD

echo "Removing folders for modeler"
rm -rf $MODELER/modeler
rm -rf $MODELER/runtime

echo "Copying folders for modeler"
cp -r ./$BUILD/modeler ~/Projects/mendix/integration/modeler/StartUpProject/bin/modeler
cp -r ./$BUILD/runtime ~/Projects/mendix/integration/modeler/StartUpProject/bin/runtime

echo "Removing folders for runtime"
rm -rf $RUNTIME
mkdir -p $RUNTIME/6-build$BUILD

echo "Copying folders for runtime"
cp -r ./$BUILD/modeler $RUNTIME/6-build$BUILD/modeler
cp -r ./$BUILD/runtime $RUNTIME/6-build$BUILD/runtime

echo "Removing downloaded files"
rm -rf $BUILD
rm -f mxbuild-6-build$BUILD.tar.gz

